(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0e89d438"],{"11d3":function(t,e,i){"use strict";i.r(e);var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("div",{staticClass:"card p-4 shadow m-4"},[i("ContractCard")],1),t.addReceiptVisible&&t.record?i("transition",[i("div",{staticClass:"card p-4 shadow m-4"},[i("ReceiptAddForm")],1)]):t._e(),i("div",{staticClass:"card p-4 shadow m-4"},[i("FileAttatchment")],1),t.records&&t.record?i("div",{staticClass:"card p-4 shadow m-4"},[i("receipt-table")],1):t._e(),i("transition",[t.popupIsOn?i("ReceiptModal",{on:{"request-close":t.closePopup},scopedSlots:t._u([{key:"body",fn:function(){return[i("div",{staticClass:"d-flex justify-content-evenly mt-5"},[i("button",{staticClass:"btn btn-lg btn-danger my-5",on:{click:t.deleteItem}},[t._v("نعم")]),i("button",{staticClass:"btn btn-lg btn-outline-secondary my-5",on:{click:t.closePopup}},[t._v("لا")])])]},proxy:!0}],null,!1,238214803)}):t._e()],1),i("transition",[t.display?i("receipt-modal",{attrs:{msg:t.selectedReceipt},on:{"request-close":t.closeDisplay},scopedSlots:t._u([{key:"body",fn:function(){return[t.isGettingFile?i("div",[i("h2",[t._v("Loading File...")])]):t.receiptFile?i("iframe",{staticClass:"subframe",attrs:{"data-class":"subframe","data-slug-hash":"GCyhb",src:t.receiptFile}}):i("div",[i("h2",[t._v("Error")])])]},proxy:!0}],null,!1,4150055201)}):t._e()],1)],1)},a=[],r=(i("7db0"),i("d3b7"),i("3ca3"),i("ddb0"),i("2b3d"),i("96cf"),i("1da1")),s=i("5530"),c=i("2f62"),o=i("a81d"),l=function(){var t=this,e=t.$createElement,i=t._self._c||e;return t.record?i("div",{staticClass:"rtl"},[t._l(t.headersComplete,(function(e){return i("div",{key:e.ar,staticClass:"cell-container"},[i("h5",{staticClass:"cell-title text-right"},[t._v(" "+t._s(t.Attributes[e].titleAr)+" ")]),i("h5",{staticClass:"cell-value text-center"},[t._v(" "+t._s(t.Attributes[e].render(t.record[e]))+" ")]),i("div",{staticClass:"cell-break"})])})),i("div",[i("button",{staticClass:"btn btn-primary",on:{click:t.addReceipt}},[t._v("إضافة فاتورة")])])],2):t.isGettingData?i("div",[i("h2",[t._v("Loading...")])]):i("div",[i("h2",[t._v("Not Found")])])},d=[],u=i("2b0e"),p=i("9add"),m=u["default"].extend({inject:["setReceiptAddMode"],computed:Object(s["a"])({id:function(){return this.$route.params.id},Attributes:function(){return p["a"].Attributes}},Object(c["c"])("contracts",["isGettingData","records","record","headersComplete"])),methods:{addReceipt:function(){this.setReceiptAddMode()}}}),f=m,h=(i("4d0e"),i("2877")),b=Object(h["a"])(f,l,d,!1,null,"0fb13b32",null),v=b.exports,g=function(){var t=this,e=t.$createElement,i=t._self._c||e;return t.hasFile?t.file?i("div",[i("iframe",{attrs:{src:t.renderFileB,frameborder:"0",width:"100%",height:"900px",allowfullscreen:""}})]):i("div",[i("button",{staticClass:"btn btn-lg btn-primary float-right",class:{disabled:this.isGettingFile},on:{click:t.downloadFile}},[t._v(" "+t._s(t.downloadFileButton)+" ")])]):i("div",[i("p",{staticClass:"h2 text-center"},[t._v("لا يوجد مرفقات")])])},y=[],_=u["default"].extend({watch:{$route:function(){this.unrenderFile()}},computed:Object(s["a"])(Object(s["a"])({},Object(c["c"])("contracts",["record","isGettingFile","file"])),{},{downloadFileButton:function(){return this.isGettingFile?"ال جاري التحميل...":"تحميل المرفقات"},id:function(){return this.$route.params.id},hasFile:function(){var t,e;return null===(t=this.record)||void 0===t||null===(e=t.ContractAttachments)||void 0===e?void 0:e.length}}),data:function(){return{renderFileB:null}},methods:{renderFile:function(){this.renderFileB=URL.createObjectURL(this.file)},unrenderFile:function(){URL.revokeObjectURL(this.file),URL.revokeObjectURL(this.renderFileB),this.$store.commit("contracts/file",null)},downloadFile:function(){var t=this;return Object(r["a"])(regeneratorRuntime.mark((function e(){var i,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(null===(i=t.record)||void 0===i?void 0:i.ContractAttachments.length){e.next=2;break}return e.abrupt("return",alert("لا يوجد"));case 2:return e.next=4,t.$store.dispatch("contracts/downloadFile",null===(n=t.record)||void 0===n?void 0:n.ContractAttachments[0].id);case 4:t.renderFile();case 5:case"end":return e.stop()}}),e)})))()}},beforeMount:function(){this.unrenderFile()}}),C=_,j=Object(h["a"])(C,g,y,!1,null,null,null),F=j.exports,O=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("h4",{staticClass:"text-center mb-5"},[t._v("الفواتير")]),i("table",{staticClass:"table table-striped"},[i("table-head",{attrs:{titles:t.titles}}),i("table-body")],1)])},x=[],R=(i("99af"),i("d81d"),i("2909")),A=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("thead",[i("tr",{attrs:{scope:"row"}},[t._l(t.titles,(function(e,n){return i("th",{key:n},[t._v(" "+t._s(e)+" ")])})),t._t("default")],2)])},D=[],w=u["default"].extend({props:{titles:{type:Array,default:function(){return[]}}}}),I=w,$=Object(h["a"])(I,A,D,!1,null,null,null),k=$.exports,E=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("tbody",t._l(t.records,(function(e,n){return i("tr",{key:e.id},[t._l(t.getFormattedRecord(n),(function(e,n){return i("td",{key:n},[t._v(t._s(e))])})),i("td",[t.receiptHasAttatchment(e)?i("button",{staticClass:"btn btn-sm btn-outline-primary mx-1",on:{click:function(i){return t.openDisplay(e)}}},[t._v(" عرض ")]):t._e(),t.permissions.canEdit?i("router-link",{attrs:{to:"/receipts/"+e.ContractId+"/edit/"+e.id}},[i("button",{staticClass:"btn btn-sm btn-outline-warning mx-1"},[t._v("تعديل")])]):t._e(),t.permissions.canDelete?i("button",{staticClass:"btn btn-sm btn-outline-danger mx-1",on:{click:function(i){return t.handleDelete(e.id)}}},[t._v(" حذف ")]):t._e()],1),t._t("default")],2)})),0)},P=[],N=i("d4ec"),L=i("ade3"),M=i("c1df"),U=i.n(M),G=i("ec90"),S=i.n(G),B=function t(){Object(N["a"])(this,t),Object(L["a"])(this,"id",void 0),Object(L["a"])(this,"createdAt",void 0),Object(L["a"])(this,"updatedAt",void 0),Object(L["a"])(this,"enterDate",void 0),Object(L["a"])(this,"payment",void 0),Object(L["a"])(this,"monthlySerial",void 0),Object(L["a"])(this,"percentage",void 0)};Object(L["a"])(B,"Attributes",{percentage:{titleAr:"النسبة",titleEn:"percentage",dbFieldName:"percentage",render:function(t){return t?S()("0.#%",100*t):""}},id:{titleAr:"id",titleEn:"id",dbFieldName:"id",render:function(t){return t||""}},createdAt:{titleAr:"createdAt",titleEn:"createdAt",dbFieldName:"createdAt",render:function(t){return t?U()(t).format("yyyy-MM-DD"):""}},updatedAt:{titleAr:"اخر تحديث",titleEn:"updatedAt",dbFieldName:"updatedAt",render:function(t){return t?U()(t).format("yyyy-MM-DD"):""}},enterDate:{titleAr:"تاريخ التسجيل",titleEn:"enterDate",dbFieldName:"enterDate",render:function(t){return t?U()(t).format("yyyy-MM-DD"):""}},payment:{titleAr:"الدفعة",titleEn:"payment",dbFieldName:"payment",render:function(t){return t?S()("#,###.###",t):""}},monthlySerial:{titleAr:"التسلسل",titleEn:"monthlySerial",dbFieldName:"monthlySerial",render:function(t){return t||""}}});var V=u["default"].extend({inject:["openPopup","closePopup","openDisplay","selectId"],computed:Object(s["a"])(Object(s["a"])({},Object(c["c"])("receipts",["records","isGettingData","headers"])),Object(c["c"])("users",["permissions"])),methods:{receiptHasAttatchment:function(t){var e;return null===(e=t.ReceiptAttachments)||void 0===e?void 0:e.length},getFormattedRecord:function(t){var e=this;return this.headers.map((function(i){return B.Attributes[i].render(e.records[t][i])}))},handleDelete:function(t){this.selectId(t),this.openPopup()},handleView:function(t){this.$router.push("/receipts/view/".concat(t))}}}),T=V,H=(i("84cb"),Object(h["a"])(T,E,P,!1,null,"028278e5",null)),q=H.exports,J=u["default"].extend({computed:Object(s["a"])(Object(s["a"])({},Object(c["c"])("receipts",["isGettingData","records","headers"])),{},{titles:function(){return[].concat(Object(R["a"])(this.headers.map((function(t){return B.Attributes[t].titleAr}))),["ادوات"])}}),components:{TableHead:k,TableBody:q}}),z=J,K=(i("dc60"),Object(h["a"])(z,O,x,!1,null,null,null)),Q=K.exports,W=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"container-fluid"},[i("div",{staticClass:"row"},[i("app-form"),i("app-image"),i("button",{staticClass:"btn btn-primary btn-lg mt-5",attrs:{disabled:t.isCreatingData},on:{click:t.submitForm}},[t._v(" "+t._s(t.submitButtonText)+" ")])],1),t.hasError?i("div",[i("h2",{staticClass:"text-center"},[t._v("فشل الاضافة")])]):t._e()])},X=[],Y=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"col-12 col-lg-12 d-flex flex-column"},[i("form",{staticClass:"form-group",on:{input:t.emitFormInput}},[i("div",{staticClass:"input-group"},[i("input",{staticClass:"form-control rtl",attrs:{type:"text",name:"contract-number",id:"contract-number",disabled:""},domProps:{value:t.record.contractNumber}}),i("label",{staticClass:"input-group-text",attrs:{for:"contract-number"}},[t._v("رقم العقد")])]),i("div",{staticClass:"input-group mt-3"},[t._m(0),i("input",{directives:[{name:"model",rawName:"v-model",value:t.serial,expression:"serial"}],staticClass:"form-control rtl",attrs:{type:"number",name:"serial",id:"serial"},domProps:{value:t.serial},on:{input:function(e){e.target.composing||(t.serial=e.target.value)}}}),i("label",{staticClass:"input-group-text",attrs:{for:"serial"}},[t._v("مسلسل")])]),i("div",{staticClass:"input-group mt-3"},[t._m(1),i("input",{directives:[{name:"model",rawName:"v-model",value:t.payment,expression:"payment"}],staticClass:"form-control rtl",attrs:{type:"number",name:"amount",id:"amount"},domProps:{value:t.payment},on:{input:function(e){e.target.composing||(t.payment=e.target.value)}}}),i("label",{staticClass:"input-group-text",attrs:{for:"amount"}},[t._v("القيمة المالية")])]),i("div",{staticClass:"input-group mt-3"},[t._m(2),i("input",{directives:[{name:"model",rawName:"v-model",value:t.date,expression:"date"}],staticClass:"form-control rtl",attrs:{type:"date",name:"date",id:"date"},domProps:{value:t.date},on:{input:function(e){e.target.composing||(t.date=e.target.value)}}}),i("label",{staticClass:"input-group-text",attrs:{for:"date"}},[t._v("تاريخ التسجيل")])])])])},Z=[function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("label",{staticClass:"input-group-text",attrs:{for:"serial"}},[i("i",{staticClass:"fas fa-sort-numeric-up"})])},function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("label",{staticClass:"input-group-text",attrs:{for:"amount"}},[i("i",{staticClass:"fas fa-dollar-sign"})])},function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("label",{staticClass:"input-group-text",attrs:{for:"date"}},[i("i",{staticClass:"fas fa-calendar-week"})])}],tt={computed:Object(s["a"])({},Object(c["c"])("contracts",["record"])),inject:["captureInput"],data:function(){return{serial:void 0,payment:void 0,date:void 0,fileName:"",fileContent:"",selectedFile:""}},methods:{emitFormInput:function(){var t={monthlySerial:this.serial,payment:this.payment,enterDate:this.date};this.captureInput(t)}}},et=tt,it=Object(h["a"])(et,Y,Z,!1,null,null,null),nt=it.exports,at=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"px-3"},[i("div",{staticClass:"col-12 mt-5 px-5"},[i("div",{staticClass:"card"},[i("div",{staticClass:"card-header text-center"},[t._v("المرفقات")]),i("div",{staticClass:"card-body"},[i("iframe",{attrs:{src:t.fileContent,width:"100%",height:"250rem"}})])])]),i("div",{staticClass:"form-file mt-3"},[i("input",{staticClass:"form-file-input",attrs:{type:"file",name:"document",id:"file",accept:"application/pdf, image/png, image/jpg, image/jpeg"},on:{change:t.handleSelectFile}}),i("label",{staticClass:"form-file-label",attrs:{for:"file"}},[i("span",{staticClass:"form-file-text"},[t._v(t._s(t.displayFileName))]),i("span",{staticClass:"form-file-button"},[t._v("رفع ملف")])])])])},rt=[],st=(i("b0c0"),u["default"].extend({data:function(){return{fileName:"",fileContent:""}},computed:{displayFileName:function(){return this.fileName?this.fileName:"Choose File"}},inject:["captureInput"],methods:{handleSelectFile:function(t){var e=t.target.files[0];this.captureInput({documentFile:e}),this.fileName=e.name,this.fileContent=URL.createObjectURL(e)}}})),ct=st,ot=Object(h["a"])(ct,at,rt,!1,null,null,null),lt=ot.exports,dt={computed:Object(s["a"])(Object(s["a"])(Object(s["a"])({id:function(){return this.$route.params.id}},Object(c["c"])("contracts",["record"])),Object(c["c"])("receipts",["isCreatingData"])),{},{submitButtonText:function(){return this.isCreatingData?"جاري الحفظ":"حفظ"}}),data:function(){return{formData:{},hasError:!1}},provide:function(){var t=this;return{captureInput:function(e){t.formData=Object.assign(t.formData,e)}}},inject:["setReceiptAddMode","initPage"],methods:{submitForm:function(){var t=this;return Object(r["a"])(regeneratorRuntime.mark((function e(){var i,n,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:for(n in t.formData.ContractId=t.id,i=new FormData,t.formData)i.append(n,t.formData[n]);return e.next=5,t.$store.dispatch("receipts/createRecord",i);case 5:a=e.sent,"error"===a?t.hasError=!0:(t.hasError=!1,t.setReceiptAddMode(!1),t.initPage());case 7:case"end":return e.stop()}}),e)})))()}},components:{AppImage:lt,AppForm:nt}},ut=dt,pt=Object(h["a"])(ut,W,X,!1,null,null,null),mt=pt.exports,ft={data:function(){return{receiptFile:null,display:!1,popupIsOn:!1,receiptDeleteId:0,selectedID:null,addReceiptVisible:!1}},provide:function(){return{openPopup:this.openPopup,closePopup:this.closePopup,openDisplay:this.openDisplay,closeDisplay:this.closeDisplay,selectId:this.selectId,addReceiptVisible:!1,setReceiptAddMode:this.setReceiptAddMode,initPage:this.initPage}},computed:Object(s["a"])(Object(s["a"])(Object(s["a"])({selectedReceipt:function(){var t=this,e=this.records.find((function(e){return e.id==t.selectedID}));return e.monthlySerial+" فاتورة رقم"},id:function(){return this.$route.params.id}},Object(c["c"])("contracts",["record","file"])),Object(c["c"])("receipts",["records","isGettingFile"])),Object(c["c"])("receipts",{subFile:"file"})),methods:{setReceiptAddMode:function(){this.addReceiptVisible=!this.addReceiptVisible},selectId:function(t){this.selectedID=t},cleanURL:function(){this.receiptFile&&(this.receiptFile=URL.revokeObjectURL(this.subFile))},openDisplay:function(t){this.selectId(t.id);var e=t.ReceiptAttachments[0].id;this.display=!0,this.downloadReceiptFile(e)},closeDisplay:function(){this.cleanURL(),this.selectId(null),this.display=!1},closePopup:function(){this.popupIsOn=!1},openPopup:function(){this.popupIsOn=!0},deleteItem:function(){this.$store.dispatch("receipts/deleteRecord",this.selectedID),this.closePopup()},initPage:function(){var t=this.$route.params.id;this.$store.dispatch("contracts/downloadRecord",t),this.$store.dispatch("receipts/downloadRecords",t),this.resetData()},resetData:function(){this.receiptFile=null,this.display=!1,this.popupIsOn=!1,this.receiptDeleteId=0,this.selectedID=null,this.addReceiptVisible=!1},downloadReceiptFile:function(t){var e=this;return Object(r["a"])(regeneratorRuntime.mark((function i(){return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return i.next=2,e.$store.dispatch("receipts/downloadFile",t);case 2:e.receiptFile=URL.createObjectURL(e.subFile);case 3:case"end":return i.stop()}}),i)})))()}},created:function(){this.initPage()},watch:{$route:function(){this.initPage()}},components:{ReceiptModal:o["a"],ContractCard:v,FileAttatchment:F,ReceiptTable:Q,ReceiptAddForm:mt}},ht=ft,bt=Object(h["a"])(ht,n,a,!1,null,"e9b7a552",null);e["default"]=bt.exports},"42bd":function(t,e,i){},"4d0e":function(t,e,i){"use strict";var n=i("993d"),a=i.n(n);a.a},"5b78":function(t,e,i){},"7db0":function(t,e,i){"use strict";var n=i("23e7"),a=i("b727").find,r=i("44d2"),s=i("ae40"),c="find",o=!0,l=s(c);c in[]&&Array(1)[c]((function(){o=!1})),n({target:"Array",proto:!0,forced:o||!l},{find:function(t){return a(this,t,arguments.length>1?arguments[1]:void 0)}}),r(c)},"84cb":function(t,e,i){"use strict";var n=i("5b78"),a=i.n(n);a.a},"993d":function(t,e,i){},dc60:function(t,e,i){"use strict";var n=i("42bd"),a=i.n(n);a.a}}]);
//# sourceMappingURL=chunk-0e89d438.9e3cb6e5.js.map